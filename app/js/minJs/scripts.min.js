function Canvas(){var e=document.getElementById("canvas_map"),t=3094,n=1560,d=e.getContext("2d"),s=document.getElementById("img"),o=window.innerWidth/t*.75;e.width=.75*window.innerWidth,e.height=n*o,this.drawIcons=function(c){c.forEach(function(e,t){var n=calculatedPositon(c[t]),s=typeAccidents(c[t]),a=colorIcon(s),i=36*o*2+"px";d.font=i+" Material Icons",d.fillStyle=a,d.fillText(s,n.x*o,n.y*o)})},this.startDraw=function(e){d.drawImage(s,0,0,t*o,n*o),this.drawIcons(e)},this.clear=function(){d.fillStyle="#FFFFFF",d.fillRect(0,0,e.width,e.height)},this.clearIcons=function(){d.fillStyle="#FFFFFF",d.fillRect(0,0,e.width,e.height),d.drawImage(s,0,0,t*o,n*o)}}function calculatedPositon(e){var t,n,s={x:0,y:0};return t=e.point.x-12.94303529912,n=52.64611109803-e.point.y,s.x=Math.round(t/.00034508963),s.y=Math.round(n/.00020789677),s}function showPage(){document.getElementById("loader").style.display="none",document.getElementById("headTitle").style.display="block",document.getElementById("app").style.display="block"}function test(){var e=document.getElementById("img");document.getElementById("material-icons");e.addEventListener("load",function(e){loadAccidents(),setTimeout(function(){showPage()},500)})}function removeHideClass(e){for(var t=3;t<e.childNodes.length;t+=2)e.childNodes[t].classList.remove("secondary-text__hidden")}function removeSelectedClass(e){e.classList.remove("mdc-list-item_selected")}function changeIconToClear(e){e.innerHTML="clear"}function showDetails(e){var t=e.childNodes[2],n=e.childNodes[4];addSelectedClass(e),removeHideClass(t),changeIconToClear(n)}function addHideClass(e){for(var t=3;t<e.childNodes.length;t+=2)e.childNodes[t].classList.add("secondary-text__hidden")}function addSelectedClass(e){e.classList.add("mdc-list-item_selected")}function changeIconToArrow(e){e.innerHTML="arrow_drop_down"}function hideDetails(e){var t=e.childNodes[2],n=e.childNodes[4];removeSelectedClass(e),addHideClass(t),changeIconToArrow(n)}function changeState(){this.classList.contains("mdc-list-item_selected")?hideDetails(this):showDetails(this)}function loadAccidents(){var e=new XMLHttpRequest;e.open("GET","js/incidents.json",!0),e.send(),e.onreadystatechange=function(){if(4===e.readyState)if(200!==e.status)alert(e.status+": "+e.statusText);else try{draw(JSON.parse(e.responseText))}catch(e){alert("Error "+e.message)}}}function draw(e){deleteLiElements(),createLiElements(e);var t=new Canvas;t.clear(),t.startDraw(e),setTimeout(function(){t.clearIcons(),t.drawIcons(e)},10),document.getElementById("material-icons").addEventListener("load",function(e){console.log("All ICON resources finished loading!")})}function typeAccidents(e){var t;switch(e.type){case 1:t="error";break;case 2:t="warning";break;case 3:t="location_off";break;default:t="clear"}return t}function colorIcon(e){var t;switch(e){case"warning":t="#C30000";break;case"error":t="#A423FF";break;case"location_off":t="#0200AB";break;default:t="#000000"}return t}function createLiElement(e){var t=typeAccidents(e);return liElement=document.createElement("li"),liElement.className="mdc-list-item",liElement.innerHTML='<span class="mdc-list-item__graphic material-icons md-36 orange600" aria-hidden="true">'+t+'</span>\n<span class="mdc-list-item__text">'+e.details+" on "+e.from+'\n<span class="mdc-list-item__secondary-text">'+e.id+'</span>\n<span class="mdc-list-item__secondary-text secondary-text__hidden">Type : '+e.type+'</span>\n<span class="mdc-list-item__secondary-text secondary-text__hidden">Position : x: '+e.point.x+", y: "+e.point.y+'</span>\n<span class="mdc-list-item__secondary-text secondary-text__hidden">From: '+e.from+'</span>\n<span class="mdc-list-item__secondary-text secondary-text__hidden">To: '+e.to+'</span>\n<span class="mdc-list-item__secondary-text secondary-text__hidden">Details: '+e.details+'</span>\n<span class="mdc-list-item__secondary-text secondary-text__hidden">Delay: '+e.delay+'</span>\n<span class="mdc-list-item__secondary-text secondary-text__hidden">Magnitude: '+e.magnitude+'</span>\n</span>\n<span class="mdc-list-item__meta material-icons md-36" aria-hidden="true">arrow_drop_down</span>',liElement.onclick=changeState,liElement}function deleteLiElements(){for(var e=document.getElementById("accidentsList"),t=e.children.length,n=0;n<t;n++)e.removeChild(e.children[0]);(new Canvas).clearIcons()}function createLiElements(e){var t,n=document.getElementById("accidentsList");sortingAccidentList(e),e.forEach(function(e){t=createLiElement(e),n.insertBefore(t,n.firstChild)})}function sortingAccidentList(e){for(var t=0;t<e.length;t++)for(var n=t;0!==n;)e[n-1].delay<e[n].delay&&swapLiElements(e,n-1,n),n--;return e}function swapLiElements(e,t,n){var s;s=e[n],e[n]=e[t],e[t]=s}setInterval(function(){deleteLiElements(),loadAccidents()},16e4),test();